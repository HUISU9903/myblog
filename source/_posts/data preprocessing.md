---
title: "데이터 전처리"
excerpt: "방대한 데이터를 가공하는 방법을 알아본다 "
categories:

- R
tags:
- [R Study]
date: 2022-03-15 09:00:00

---
# 데이터 전처리
대부분의 데이터는 방대하기 때문에 내가 원하는 정보를 찾기 위해서는 데이터의 전처리가 필수다.
데이터 전처리에 쓰이는 함수는 많지만  R에 내장된 함수보다는 dplyr패키지가 제공하는 함수들이
데이터 전처리에 유리하기 때문에 많은 사람들이 dplyr 패키지를 이용하고 있다.

## dplyr 패키지 설치 및 실행

```r
install.packages("dplyr") # dplyr 패키지 설치
library(dplyr) # dplyr 패키지 실행
```

## dplyr 내장 함수(1)

### rename()

rename() 함수는 데이터세트에 있는 변수이름을 바꿔준다. 한글이름을 영어로 바꾸는 경우나 어려운 이름을 쉽게 바꾸는 경우에 활용한다.
```r
데이터세트 <- 데이터세트 %>% rename(새 변수이름1 = 기존 이름1,
                                 (새 변수이름2 = 기존 이름2, ... )
```

### count()

count() 함수는 데이터세트의 범주형 변수에서 범주들의 빈도를 세는 **table() 함수와 같은 기능**을 한다.
그러나 count() 함수의 명령어를 쓰는 방식은 table() 함수와 다르다.

```r
count(데이터세트, 변수)
table(데이터세트$변수)
```

### select()

select() 함수는 데이터세트의 열에서 일부를 추출하거나 불필요한 열을 삭제해서 새로운 객체를 만들 때 사용한다.
데이터세트의 용량이 너무 많으면 분석이 늦어지기에 필요한 열만 추출해서 분석하는 경우가 많다.

```r
새 데이터세트 <- 데이터세트 %>% select(열1,열2 ...) 
```

데이터세트에서 추출할 변수가 많을 경우에는 제외할 변수들을 빼는 방식으로 만드는 방식이 편하다.

```r
새 데이터세트 <- 데이터세트 %>% select(-열1,-열2 ...) 
새 데이터세트 <- 데이터세트 %>% select(-c(열1,열2 ...) 
```

### slice()

slice() 함수는 데이터세트에서 일부 행들을 잘라서 추출 하는 함수이다.

```r
데이터세트 %>% slice(행1,행2 ...) 
```

### filter()

filter() 함수는 열마다 조건을 정한 후에 이에 맞는 행을 추출하는 함수이다.

```r
데이터세트 %>% filter(조건1,조건2, ...) 
```

filter() 함수에서 데이터 추출 조건은 조건연산자와 논리연산자로 지정한다. 
연산자 링크

복수의 조건을 모두 충족하는 데이터의 추출을 위해서는 조건마다 '&'의 연결이 필요하다.

```r
데이터세트 %>% filter( 조건1 & 조건2 & 조건3 ) 
```

복수의 조건중 하나라도 충족하는 데이터의 추출을 위해서는 조건마다 '|'의 연결이 필요하다.
또는 '%in%c' 를 이용해서도 연결할 수 있다.

```r
데이터세트 %>% filter( 조건1 | 조건2 | 조건3 ) 
데이터세트 %>% filter( 조건%in%c(1,2,3)) 
```

## dplyr 내장 함수(2)

### mutate()

풍부한 분석을 위해 새로운 파생변수를 만들 수 있다. mutate() 함수는 동시에 여러 개의 변수를 만들 수 있다.

```r
데이터세트 <- 데이터세트 %>% 
                                mutate(새 변수1 = 변수 만들기 연산,
                                새 변수2 = 변수 만들기 연산, ...) 
```

### group_by()

group_by() 함수의 () 안에 범주형 변수의 이름을 적으면 행을 범주별로 분류한다.

```r
group_by() # 행을 범주별로 분류
```

### summarise()

집단별로 통계값을 구할 때에 쓰는 함수이다. 여러 개의 명령을 동시에 수행할 수 있다.

```r
데이터세트 %>% summarise(m=mean(변수))  == mean(데이터세트$변수) 
# mean() 함수는 바로 결과값을 출력하지만 summarise 함수는 새로 만든 변수에 결과값을 할당한다.
summarise(n=n()) # 집단의 빈도를 구해준다.
```

### ifelse()

ifelse() 함수는 조건에 따라 명령문을 수행하는 함수이다. 

```r
ifelse(조건,명령문 A, 명령문 B) 
# 조건이 TRUE이면 명령문 A를 수행, FALSE이면 명령문 B를 수행
```

### arrange() 

데이터를 크기 기준으로 정렬해주는 함수이다.

```r
arrange() # 데이터를 오름차순으로 정렬
arrange() # 데이터를 내림차순으로 정렬
```

## dplyr 내장 함수 3 

A라는 데이터와 B라는 데이터를 서로 합쳐서 C라는 데이터를 만들어야 할때 유용한 함수이다.   
데이터의 결합은 데이터에 공통적으로 있는 열을 기준으로 하며, 기준이 되는 열은 by = "기준 열" 로 지정

### left_join()

A에 있는 행 번호(1,2,3)를 중심으로 B를 A에 결합한다. 
```r
데이터세트 <- left_join(데이터세트1,데이터세트2,by="기준 열")
```

### inner_join() 

A와 B에 공통적으로 있는 행만 결합한다. (교집합)
```r
데이터세트 <- inner_join(데이터세트1,데이터세트2,by="기준 열")
```

### full_join()

A와 B에 있는 모든 행을 결합한다. (합집합)
```r
데이터세트 <- full_join(데이터세트1,데이터세트2,by="기준 열")
```

### as.~()

데이터의 분석을 위해서 데이터의 유형을 바꿔야 할 때가 있다. 벡터의 유형을 바꾸거나, 리스트 형태의 데이터를 데이터프레임으로 바꾸는 경우가 대표적이다.
이럴때 쓰는 함수가 as.~()이다. 예를 들어 데이터프레임으로 바꾸고 싶으면 as.data.frame()이다.

```r
리스트이름 <-as.data.frame(리스트이름) 
```

### cut()

데이터 분석에서는 수치형 데이터를 구간으로 구분해서 범주로 만들어 분석하는 경우가 많다.
간단한 구간 구분의 경우 R 내장 함수인 cut()를 이용하면 편리하다.

```r
데이터세트$새 변수 <- cut(데이터세트$구분할 변수, breaks=구간수)
데이터세트$새 변수 <- cut(데이터세트$구분할 변수, breaks=구간수,
                       labels = c("범주이름1", "범주이름2"...) 
```

구분하는 구간의 간격을 지정해서 구분하는 방법이다. breaks에서 구분 간격을 지정하면 된다.
구간을 지정할때는 '최솟값을 포함하라'는 명령인 파라미터 'include.lowest = T'를 추가해야 한다.
cut() 함수는 '초과~이하'를 기준으로 구간을 분류하기 때문

```r
데이터세트$새 변수 <- cut(데이터세트$구분할 변수, breaks=구간수,
                       labels = c("범주이름1", "범주이름2"...),include.lowest = T)  
```

### substr() 

R 내장함수인 substr() 함수로 데이터의 문자 변수에서 일부 문자를 분리해서 별도의 변수를 만들 수 있다.
ex) 날짜변수에서 연도만 분리하거나, 주소 변수에서 시나 도를 분리

```r
substr(데이터세트$변수, 분리 시작 순서, 분리 끝 순서) #변수의 시작 ~ 끝으로 분리  
```

### sample_n() , sample_frac()

데이터에서 무작위로 샘플을 추출하는 함수이다. sample_n()은 개수를 기준으로 추출하고, sample_frac()는 비율을 기준으로 추출한다.

```r
sample_n(데이터세트, 개수) 
sample_frac(데이터세트, 비율)
```





